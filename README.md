# Simplicity

Simplicity is a simple abstraction around URLSession that makes it easy to make type safe HTTP requests.

It was inspired by the Clients generated by swift-openapi-generator.
You can add middleware to perform operations before or after an outgoing request is executed.

## Usage

```swift
// First you create a type to represent a request to your endpoint
struct LoginRequest: HTTPRequest {
    struct RequestBody: Encodable & Sendable {
        var username: String
        var password: String
    }
    
    struct ResponseBody: Decodable & Sendable {
        var token: String
    }
    
    static let operationID: String = "LoginRequest"
    var path: String { "/login" }
    var httpMethod: Simplicity.HTTPMethod { .post }
    var headers: [String : String] { [:] }
    var queryItems: [URLQueryItem] { [] }
    var httpBody: RequestBody
    
    // add custom logic to setup your urlrequest here, or you can use the default protocol implementation
    func encodeURLRequest(baseURL: URL) throws -> URLRequest {
        let url = baseURL.appending(path: path).appending(queryItems: queryItems)
        var urlRequest = URLRequest(url: url)
        urlRequest.allHTTPHeaderFields = headers
        urlRequest.httpMethod = httpMethod.rawValue
        urlRequest.httpBody = try JSONEncoder().encode(httpBody)
        return urlRequest
    }
    
    // add custom logic to decode your response here, or you can use the default protocol implementation
    func decodeResponseData(_ data: Data) throws -> ResponseBody {
        try JSONDecoder().decode(ResponseBody.self, from: data)
    }
}

// next initialize a client.
var client = HTTPClient(urlSession: .shared, baseURL: "https://myapi.com", middlewares: [LoggingMiddleware()])

// Finally, send your request
let response = try await client.send(request: LoginRequest(username: "JohnDoe1234", password: "P@ssword123"))
print(response.token)
```

## Middleware

Setting up middleware is also quite simple

```swift
struct LoggingMiddleware: Middleware {
    private let logger: Logger
    
    init(logger: Logger) {
        self.logger = logger
    }
    
    func intercept(
        request: URLRequest,
        baseURL: URL,
        operationID: String,
        next: @Sendable (URLRequest, URL, String) async throws -> (data: Data, response: HTTPURLResponse)
    ) async throws -> (data: Data, response: HTTPURLResponse) {
        // log request information
        logger.info("""
        REQUEST:
        \(request.httpMethod) \(request.url)
        Headers: \(request.allHTTPHeaderFields)
        Query: \(request.query)
        Request Body: \(String(data: request.httpBody!, encoding: .utf8)!)
        """)
        
        // continue on to execute the request
        let (data, response) = try await next(request, baseURL, operationID)
        
        // log response
        logger.info("""
        RESPONSE:
        HTTP Status: \(response.statusCode)
        Headers: \(response.allHeaderFields)
        Response Body: \(String(data: data, encoding: .utf8)!)
        """)
    }
}
```
